{"version":3,"file":"game.js","sourceRoot":"","sources":["../../../src/game.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by Paul on 12/7/2017.\n */\nimport {inject} from 'aurelia-framework';\n\nimport {CustomEventHandler, PropertyChangedEventArgs} from \"./my-custom-events-handler\";\nimport {CanvasController} from \"./canvas-controller\";\nimport {App} from \"./app\";\nimport {ArrowObject} from \"./arrow_object\";\nimport {Target} from \"./target\";\n\nfunction findClosestAncestorByClass(el: Element, cls: string) {\n    // tslint:disable-next-line\n    while ((el = el.parentElement) && !el.classList.contains(cls)) {}\n    return el;\n}\n\n@inject(App)\nexport class Game {\n    public get GPSWorking(): boolean {\n        return this._gpsworking;\n    }\n\n    public set GPSWorking(value: boolean) {\n        this._gpsworking = value;\n        if (this.north_arrow != null) {\n            this.north_arrow.visible = this._gpsworking;\n        }\n        if (this.target_arrow != null) {\n            this.target_arrow.visible = this._gpsworking;\n        }\n    }\n    private _gpsworking: boolean;\n    get closest_target(): Target {\n        return this._closest_target;\n    }\n    set closest_target(value: Target) {\n        const old = this._closest_target;\n        if (old === value) {return;}\n        this._closest_target = value;\n        this.onPropertyChangedEvent.Invoke(this, new PropertyChangedEventArgs(\"closest_target\", old, value));\n    }\n\n    get myHeading(): number {\n        return this._myHeading;\n    }\n    set myHeading(value: number) {\n        const old = this._myHeading;\n        if (old === value) {return;}\n        this._myHeading = value;\n        this.onPropertyChangedEvent.Invoke(this, new PropertyChangedEventArgs(\"myHeading\", old, value));\n        this.north_arrow.direction = Math.PI * 1.5 - this._myHeading;\n    }\n\n    get myLatitude(): number {\n        return this._myLatitude;\n    }\n    set myLatitude(value: number) {\n        const old = this._myLatitude;\n        if (old === value) {return;}\n        this._myLatitude = value;\n        this.onPropertyChangedEvent.Invoke(this, new PropertyChangedEventArgs(\"myLatitude\", old, value));\n    }\n\n    get myLongitude(): number {\n        return this._myLongitude;\n    }\n    set myLongitude(value: number) {\n        const old = this._myLongitude;\n        if (old === value) {return;}\n        this._myLongitude = value;\n        this.onPropertyChangedEvent.Invoke(this, new PropertyChangedEventArgs(\"myLongitude\", old, value));\n    }\n\n    public PlayerType: string = \"Jager\";\n    public myGroupName: string = \"test\";\n    public fieldnames: Array<string>;\n    public onAttach: CustomEventHandler<Game, boolean>;\n    public onDetach: CustomEventHandler<Game, boolean>;\n    public onPropertyChangedEvent: CustomEventHandler<Game, PropertyChangedEventArgs>;\n    private _myLongitude: number;\n    private _myLatitude: number;\n    private _myHeading: number;\n    private lastRequest: number;\n\n    private _isAttached: boolean;\n    private default_width: number = 200;\n    private default_height: number = 200;\n    private mainContentContainer: HTMLDivElement;\n    private wrapperContainer: HTMLDivElement;\n    private gameCanvas: HTMLCanvasElement;\n    private canvas_controller: CanvasController;\n    private _canvas_dimension: [number, number];\n    private target_arrow: ArrowObject;\n    private north_arrow: ArrowObject;\n    private targets: Array<Target>;\n    private _closest_target: Target;\n    private myRequest;\n\n\n    StartPollingData() {\n        setTimeout(this.StartPollingData.bind(this), 5000);\n        const t = Date.now() - this.lastRequest;\n        if (this.lastRequest === 0 || t >= 5000) {\n            this.doRequest();\n        }\n    }\n\n    doRequest() {\n        this.myRequest = new XMLHttpRequest();\n        let route = \"/ivossenjacht/\" + this.myGroupName;\n        this.myRequest.addEventListener(\"load\", this.reqListener.bind(this));\n        this.myRequest.open(\"POST\", route);\n        this.myRequest.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n        let params = \"lat=\"+encodeURIComponent(this.myLatitude.toString()) +\n            \"&lon=\"+encodeURIComponent(this.myLongitude.toString());\n        this.myRequest.send(params);\n        this.lastRequest = Date.now();\n    }\n\n    reqListener () {\n        const txt = this.myRequest.response;\n        let obj = JSON.parse(txt);\n        this.PlayerType = obj[\"type\"];\n        this.targetsUpdatedCallBack(obj[\"targets\"]);\n        setTimeout(this.doRequest.bind(this), 1000)\n    }\n    constructor(app?: App) {\n        this.initialize();\n        this._gpsworking = false;\n        //navigator.geolocation.getCurrentPosition(this.setLocation.bind(this), this.locationError.bind(this));\n        navigator.geolocation.watchPosition(this.updateLocation.bind(this), this.errorLocation.bind(this));\n\n        this._myLongitude = 0;\n        this._myLatitude = 0;\n        this._myHeading = 0;\n        this.targets = [];\n        this.closest_target = null;\n        this.lastRequest=0;\n        this.StartPollingData();\n        this.onAttach.AddMethod((caller, t) => {\n            if (!this.gameCanvas) {return;}\n            this.canvas_controller.setCanvas(this.gameCanvas);\n            this.canvas_controller.setBackgroundColor(\"brown\");\n            this.north_arrow = new ArrowObject(this.canvas_controller,\n                                                0.5, 0.5 , 0.4, 0.01,\n                                                Math.PI * 1.5 - this.myHeading, \"gray\");\n            this.north_arrow.visible = this.GPSWorking;\n            this.target_arrow = new ArrowObject(this.canvas_controller,\n                                                0.5, 0.5 , 0.3, 0.02,\n                                                Math.PI * 1.5 - this.myHeading, \"navy\");\n            this.target_arrow.visible = this.GPSWorking;\n            this.canvas_controller.addObject(this.north_arrow);\n            this.canvas_controller.addObject(this.target_arrow);\n            this.canvas_controller.draw();\n        }, this);\n        this.onDetach.AddMethod((caller, t) => {\n        }, this);\n\n        this.onPropertyChangedEvent.AddMethod(this.PropertyChangedCallBack, this);\n        this.canvas_controller.onPropertyChangedEvent.AddMethod(this.CanvasChangedCallBack, this);\n    }\n\n    private initialize() {\n        this.onAttach = new CustomEventHandler();\n        this.onDetach = new CustomEventHandler();\n        this.onPropertyChangedEvent = new CustomEventHandler();\n        this._isAttached = false;\n        this._canvas_dimension = [0,0];\n        this.canvas_controller = new CanvasController(60);\n    }\n\n    public get max_width(): number {\n        if (!this.mainContentContainer) {return undefined;}\n        const elem: Element = this.mainContentContainer;\n        elem.setAttribute(\"style\", \"'color:#0000FF'\");\n        const clientWidth = this.mainContentContainer.clientWidth;\n        let style = window.getComputedStyle(this.mainContentContainer, null);\n        const paddingLeft = parseFloat(style.paddingLeft);\n        const paddingRight = parseFloat(style.paddingLeft);\n        style = window.getComputedStyle(this.gameCanvas, null);\n        const marginLeft = parseFloat(style.marginLeft);\n        const marginRight = parseFloat(style.marginRight);\n        return clientWidth - paddingLeft - paddingRight - marginLeft - marginRight;\n    }\n\n    public get max_height(): number {\n        if (!this.mainContentContainer) {return undefined;}\n        const elem: Element = this.mainContentContainer;\n        const rect = elem.getBoundingClientRect();\n        const elem2 = this.wrapperContainer;\n        const elem_page_host = findClosestAncestorByClass(elem2, 'page-host');\n        let sy = 0;\n        if (elem_page_host != null) {\n            sy = elem_page_host.scrollTop;\n        }\n        let style = window.getComputedStyle(this.mainContentContainer, null);\n        const paddingTop = parseFloat(style.paddingTop);\n        const paddingBottom = parseFloat(style.paddingBottom);\n        style = window.getComputedStyle(this.gameCanvas, null);\n        const marginTop = parseFloat(style.marginTop);\n        const marginBottom = parseFloat(style.marginBottom);\n        return window.innerHeight - (rect.top + sy) - paddingBottom - paddingTop - marginTop - marginBottom - 11;\n    }\n\n    public get canvas_width(): number {\n        return this.canvas_dimension[0];\n    }\n    public set canvas_width(value: number) {\n        this.canvas_dimension = [value, this.canvas_dimension[1]];\n    }\n    public get canvas_height(): number {\n        return this.canvas_dimension[1];\n    }\n    public set canvas_height(value: number) {\n        this.canvas_dimension = [this.canvas_dimension[0], value];\n    }\n\n    public get isAttached(): boolean {\n        return this._isAttached;\n    }\n    public set isAttached(value: boolean) {\n        this._isAttached = value;\n    }\n\n    public get canvas_dimension(): [number, number] {\n        const calc_dim: [number, number] = this.calculateCanvasDimensions();\n        if (calc_dim[0] !== this._canvas_dimension[0]  || calc_dim[1] !== this._canvas_dimension[1]) {\n            this.canvas_dimension = calc_dim;\n        }\n        return this._canvas_dimension;\n    }\n\n    public set canvas_dimension(value: [number, number]) {\n        const old = this._canvas_dimension;\n        if (old[0] === value[0] && old[1] === value[1]) {return;}\n        this._canvas_dimension = value;\n        this.onPropertyChangedEvent.Invoke(this, new PropertyChangedEventArgs(\"canvas_dimension\", old, value));\n    }\n\n    public calculateCanvasDimensions(): [number, number] {\n        const width = this.max_width;\n        let height = this.max_height;\n        return [width, height];\n    }\n\n    public attached() {\n        this._isAttached = true;\n        this.onAttach.Invoke(this, false);\n    }\n    public detached() {\n        this._isAttached = false;\n        this.onDetach.Invoke(this, false);\n    }\n\n    private PropertyChangedCallBack(positions: Game, propertyChangedEventArgs: PropertyChangedEventArgs) {\n        switch (propertyChangedEventArgs.property_name) {\n            case \"canvas_dimension\":\n                break;\n            case \"myLongitude\":\n            case \"myLatitude\":\n            case \"closest_target\":\n            case \"myHeading\":\n                this.updateTargetArrow();\n            default:\n                return;\n        }\n    }\n\n    private CanvasChangedCallBack(positions: Game, propertyChangedEventArgs: PropertyChangedEventArgs) {\n        switch (propertyChangedEventArgs.property_name) {\n            default:\n                break;\n        }\n    }\n\n    private targetsUpdatedCallBack(newTargets) {\n        this.targets.length = 0;\n        for (let i = 0; i < newTargets.length; i += 1) {\n            let t = newTargets[i];\n            let p = t[\"pos\"];\n            this.targets.push(new Target(t[\"name\"], p[0], p[1]));\n        }\n        this.updateTarget()\n    }\n\n    private updateTargetArrow() {\n        if (this.target_arrow == null) {\n            return;\n        }\n        if (this.closest_target == null || this.myLongitude == null ||\n            this.myLatitude == null ) {\n            this.target_arrow.visible = false;\n            return;\n        }\n        this.target_arrow.visible = true;\n        let dir = Game.bearing(this.myLatitude, this.myLongitude,\n            this.closest_target.latitude, this.closest_target.longitude);\n        this.target_arrow.direction = this.myHeading + Math.PI * 1.5 - dir;\n    }\n\n    private updateLocation(position: Position) {\n        this.myLatitude = position.coords.latitude;\n        this.myLongitude = position.coords.longitude;\n        if (position.coords.heading != null) {\n            this.myHeading = Game.toRad(position.coords.heading);\n        }\n        this.GPSWorking = true;\n    }\n\n    private errorLocation(err: PositionError) {\n        console.log(err.message);\n    }\n\n    private updateTarget() {\n        if (this.targets == null || this.targets.length === 0) {\n            this.closest_target = null;\n            return;\n        }\n        let dis = Infinity;\n        let target: Target = null;\n        for (let i = this.targets.length-1; i >= 0; i--) {\n            let t = this.targets[i];\n            let d = Game.distHaversine(this.myLatitude, this.myLongitude, t.latitude, t.longitude);\n            if (d < dis) {\n                target = t;\n                dis = d;\n            }\n        }\n        this.closest_target = target;\n        console.log(this.closest_target.name);\n    }\n\n    private static distHaversine(lat1: number, lon1: number, lat2: number, lon2: number): number {\n        const R = 6371e3; // earth's mean radius in m\n        lat1 = lat1 * Math.PI/180;\n        lat2 = lat2 * Math.PI/180\n        lon1 = lon1 * Math.PI/180\n        lon2 = lon2 * Math.PI/180\n        const dLat = (lat2 - lat1);\n        const dLon = (lon2 - lon1);\n\n        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n            Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\n        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n        const d = R * c;\n\n        return d;\n    }\n\n    private static bearing(lat1: number, lon1: number, lat2: number, lon2: number): number {\n        const y = Math.sin(lon2 - lon1) * Math.cos(lat2);\n        const x = Math.cos(lat1)*Math.sin(lat2) -\n                  Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1);\n        const bearing = Math.atan2(y, x);\n        return bearing;\n    }\n\n    private static toDeg(radians: number) {\n        return radians * 180/Math.PI;\n    }\n    private static toRad(degrees: number) {\n        return degrees * Math.PI/180;\n    }\n}\n"]}